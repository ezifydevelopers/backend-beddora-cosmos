// Prisma Schema for Beddora SaaS
// Enhanced schema with authentication, authorization, and multi-account support

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// AUTHENTICATION & AUTHORIZATION
// ============================================

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  name          String?
  isActive      Boolean  @default(true)
  isVerified    Boolean  @default(false) @map("emailVerified")
  verifiedAt    DateTime? @map("emailVerifiedAt")
  termsAccepted Boolean  @default(false)
  twoFactorEnabled Boolean @default(false)
  twoFactorSecret String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  roles         UserRole[]
  userAccounts  UserAccount[]
  userPermissions UserPermission[]
  refreshTokens RefreshToken[]
  emailVerifications EmailVerification[]
  passwordResets PasswordReset[]
  auditLogs     AuditLog[]
  amazonAccounts AmazonAccount[]
  syncLogs       SyncLog[]
  orderImports   OrderImportStaging[]
  ppcImports     PPCImportStaging[]
  inventoryImports InventoryImportStaging[]
  listingImports ListingImportStaging[]
  refundImports  RefundImportStaging[]

  @@index([email])
  @@map("users")
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique // 'ADMIN', 'MANAGER', 'VIEWER'
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  users       UserRole[]
  permissions RolePermission[]

  @@map("roles")
}

model Permission {
  id          String   @id @default(uuid())
  name        String   @unique // 'profit.read', 'inventory.write', etc.
  resource    String   // 'profit', 'inventory', 'ppc', 'alerts'
  action      String   // 'read', 'write', 'delete', 'none'
  description String?
  scope       PermissionScope @default(GLOBAL) // GLOBAL, MARKETPLACE, PRODUCT
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@index([resource, action])
  @@map("permissions")
}

model UserRole {
  id        String   @id @default(uuid())
  userId    String
  roleId    String
  accountId String?
  createdAt DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  account   Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId, accountId])
  @@map("user_roles")
}

model RolePermission {
  id           String   @id @default(uuid())
  roleId       String
  permissionId String
  scope        PermissionScope @default(GLOBAL)
  marketplaceId String?
  productId    String?
  createdAt    DateTime @default(now())

  // Relations
  role         Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  marketplace  Marketplace? @relation(fields: [marketplaceId], references: [id], onDelete: Cascade)
  product      Product? @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId, marketplaceId, productId])
  @@map("role_permissions")
}

model UserPermission {
  id           String   @id @default(uuid())
  userId       String
  accountId    String?  // Null for global permissions, set for account-specific
  permissionId String
  createdAt    DateTime @default(now())

  // Relations
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  account      Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([userId, accountId, permissionId])
  @@index([userId, accountId])
  @@map("user_permissions")
}

enum PermissionScope {
  GLOBAL
  MARKETPLACE
  PRODUCT
}

// ============================================
// TOKEN MANAGEMENT
// ============================================

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  isRevoked Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model EmailVerification {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  usedAt    DateTime?
  createdAt DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("email_verifications")
}

model PasswordReset {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  usedAt    DateTime?
  createdAt DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("password_resets")
}

// ============================================
// ACCOUNTS & MARKETPLACES
// ============================================

model Account {
  id          String   @id @default(uuid())
  name        String
  sellerId    String?  // Amazon Seller ID
  region      String?  // 'us', 'eu', 'uk', etc.
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userAccounts UserAccount[]
  userRoles    UserRole[]
  marketplaces AccountMarketplace[]
  userPermissions UserPermission[]
  products    Product[]
  orders      Order[]
  ppcCampaigns PPC_Campaign[]
  expenses    Expense[]
  cashflow    Cashflow[]
  cogs        COGS[]
  cogsBatches Batch[]

  @@index([sellerId])
  @@map("accounts")
}

model Marketplace {
  id          String   @id @default(uuid())
  name        String   @unique
  code        String   @unique // 'amazon', 'ebay', etc.
  region      String?
  baseCurrency String? // e.g., 'USD', 'EUR', 'GBP'
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  accountMarketplaces AccountMarketplace[]
  rolePermissions RolePermission[]
  orders Order[] @relation("MarketplaceOrders")
  expenses Expense[] @relation("MarketplaceExpenses")
  cogs COGS[]

  @@map("marketplaces")
}

model UserAccount {
  id          String   @id @default(uuid())
  userId      String
  accountId   String
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false) // Default account for user
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@unique([userId, accountId])
  @@index([userId])
  @@index([accountId])
  @@map("user_accounts")
}

model AccountMarketplace {
  id           String   @id @default(uuid())
  accountId    String
  marketplaceId String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  account      Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  marketplace  Marketplace @relation(fields: [marketplaceId], references: [id], onDelete: Cascade)

  @@unique([accountId, marketplaceId])
  @@index([accountId])
  @@index([marketplaceId])
  @@map("account_marketplaces")
}

// ============================================
// PRODUCTS & INVENTORY
// ============================================

model Product {
  id              String   @id @default(uuid())
  accountId       String
  sku             String
  asin            String?
  title           String
  imageUrl        String?
  category        String?
  brand           String?
  currentPrice    Decimal  @default(0)
  cost            Decimal  @default(0)
  quantity        Int      @default(0)
  reorderLevel    Int      @default(10)
  status          String   @default("active")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  account         Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  orderItems      OrderItem[]
  inventory       Inventory[]
  purchaseOrders  PurchaseOrderItem[]
  rolePermissions RolePermission[]

  @@unique([accountId, sku])
  @@index([accountId])
  @@index([asin])
  @@map("products")
}

model Inventory {
  id          String   @id @default(uuid())
  productId   String
  quantity    Int
  changeType  String
  notes       String?
  createdAt   DateTime @default(now())

  // Relations
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("inventory")
}

model Supplier {
  id          String   @id @default(uuid())
  name        String
  email       String?
  phone       String?
  address     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  purchaseOrders PurchaseOrder[]

  @@map("suppliers")
}

model PurchaseOrder {
  id          String   @id @default(uuid())
  supplierId  String
  accountId   String
  orderNumber String   @unique
  status      String   @default("pending")
  totalAmount Decimal  @default(0)
  orderDate   DateTime @default(now())
  expectedDate DateTime?
  receivedDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  supplier    Supplier @relation(fields: [supplierId], references: [id])
  items       PurchaseOrderItem[]

  @@index([supplierId])
  @@index([accountId])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String   @id @default(uuid())
  purchaseOrderId String
  productId       String
  quantity        Int
  unitCost        Decimal
  totalCost       Decimal
  createdAt       DateTime @default(now())

  // Relations
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product         Product       @relation(fields: [productId], references: [id])

  @@index([purchaseOrderId])
  @@index([productId])
  @@map("purchase_order_items")
}

// ============================================
// ORDERS & SALES
// ============================================

model Order {
  id              String   @id @default(uuid())
  accountId       String
  marketplaceId   String?  // Links to Marketplace for profit breakdown
  orderId         String   @unique
  orderDate       DateTime
  shipDate        DateTime?
  orderStatus     String
  totalAmount     Decimal  @default(0)
  shippingCost    Decimal  @default(0)
  tax             Decimal  @default(0)
  currency        String   @default("USD")
  marketplace     String?  // Legacy field, kept for backward compatibility
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  account         Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  marketplaceRef  Marketplace? @relation("MarketplaceOrders", fields: [marketplaceId], references: [id], onDelete: SetNull)
  items           OrderItem[]
  fees            Fee[]
  refunds         Refund[]

  @@index([accountId])
  @@index([orderId])
  @@index([marketplaceId])
  @@index([orderDate])
  @@index([accountId, orderDate])
  @@map("orders")
}

model OrderItem {
  id              String   @id @default(uuid())
  orderId         String
  productId       String
  sku             String
  quantity        Int
  unitPrice       Decimal
  totalPrice      Decimal
  createdAt       DateTime @default(now())

  // Relations
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product  @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([sku])
  @@index([sku, createdAt])
  @@map("order_items")
}

model Fee {
  id          String   @id @default(uuid())
  orderId     String
  feeType     String   // 'FBA', 'Referral', 'Shipping', etc.
  amount      Decimal
  description String?
  timestamp   DateTime @default(now()) // For FBA fees aggregation by period
  createdAt   DateTime @default(now())

  // Relations
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([feeType])
  @@index([timestamp])
  @@index([feeType, timestamp])
  @@map("fees")
}

model Refund {
  id          String   @id @default(uuid())
  orderId     String
  refundId    String   @unique
  amount      Decimal
  reason      String?
  reasonCode  String?  // Added per requirements
  status      String   @default("pending")
  refundDate DateTime @default(now())
  processedAt DateTime? // Added per requirements
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([createdAt])
  @@map("refunds")
}

// ============================================
// PPC & ADVERTISING
// ============================================

model PPC_Campaign {
  id              String   @id @default(uuid())
  accountId       String
  campaignId      String
  name            String
  platform        String   @default("amazon")
  status          String   @default("active")
  budget          Decimal  @default(0)
  spend           Decimal  @default(0)
  impressions     Int      @default(0)
  clicks          Int      @default(0)
  conversions     Int      @default(0)
  acos            Decimal?
  roas            Decimal?
  startDate       DateTime
  endDate         DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  account         Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([campaignId])
  @@map("ppc_campaigns")
}

// ============================================
// EXPENSES & CASHFLOW
// ============================================

model Expense {
  id            String   @id @default(uuid())
  accountId     String
  marketplaceId String?  // Links to Marketplace for profit breakdown
  type          String   // 'fixed', 'recurring', 'one-time'
  category      String
  amount        Decimal
  description   String?
  expenseDate   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  account       Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  marketplace   Marketplace? @relation("MarketplaceExpenses", fields: [marketplaceId], references: [id], onDelete: SetNull)

  @@index([accountId])
  @@index([marketplaceId])
  @@index([expenseDate])
  @@index([accountId, expenseDate])
  @@index([type])
  @@map("expenses")
}

model Cashflow {
  id          String   @id @default(uuid())
  accountId   String
  type        String
  amount      Decimal
  description String?
  category    String?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([date])
  @@map("cashflow")
}

// ============================================
// COST OF GOODS SOLD (COGS)
// ============================================

enum CostMethod {
  BATCH
  TIME_PERIOD
  WEIGHTED_AVERAGE
}

model COGS {
  id          String   @id @default(uuid())
  accountId   String
  sku         String
  marketplaceId String
  batchId     String?
  quantity    Int
  unitCost    Decimal
  totalCost   Decimal
  costMethod  CostMethod
  shipmentCost Decimal?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  marketplace Marketplace @relation(fields: [marketplaceId], references: [id], onDelete: Cascade)
  batch       Batch?   @relation(fields: [batchId], references: [id], onDelete: SetNull)

  @@index([sku, accountId, marketplaceId])
  @@index([accountId, createdAt])
  @@index([batchId])
  @@map("cogs")
}

model Batch {
  id          String   @id @default(uuid())
  sku         String
  accountId   String
  quantity    Int
  unitCost    Decimal
  totalCost   Decimal
  receivedAt  DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  account     Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  cogsEntries COGS[]

  @@index([sku, accountId])
  @@index([accountId, receivedAt])
  @@map("batches")
}

// ============================================
// ALERTS & NOTIFICATIONS
// ============================================

model Alert {
  id          String   @id @default(uuid())
  accountId   String?
  type        String
  severity    String   @default("info")
  title       String
  message     String
  isRead      Boolean  @default(false)
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([accountId])
  @@index([isRead])
  @@index([type])
  @@map("alerts")
}

// ============================================
// REIMBURSEMENTS
// ============================================

model Reimbursement {
  id          String   @id @default(uuid())
  accountId   String
  orderId     String?
  type        String
  amount      Decimal
  status      String   @default("pending")
  description String?
  requestDate DateTime @default(now())
  processedDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([accountId])
  @@index([status])
  @@map("reimbursements")
}

// ============================================
// REPORTS & ANALYTICS
// ============================================

model Report {
  id          String   @id @default(uuid())
  accountId   String?
  userId      String?
  type        String
  name        String
  parameters  Json?
  data        Json?
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([accountId])
  @@index([userId])
  @@index([type])
  @@map("reports")
}

// ============================================
// AUDIT & LOGGING
// ============================================

model AuditLog {
  id          String   @id @default(uuid())
  userId      String
  action      String
  entity      String?
  entityId    String?
  changes     Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

model SyncLog {
  id              String   @id @default(uuid())
  userId          String
  amazonAccountId String
  syncType        String   // 'orders', 'fees', 'ppc', 'inventory', 'listings', 'refunds'
  status          String   // 'success', 'failed', 'partial'
  recordsSynced   Int      @default(0)
  recordsFailed   Int      @default(0)
  errorMessage    String?
  metadata        Json?    // Additional sync details
  startedAt       DateTime @default(now())
  completedAt     DateTime?

  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount   AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([syncType])
  @@index([startedAt])
  @@map("sync_logs")
}

// ============================================
// AMAZON ACCOUNTS (Linked Seller Central)
// ============================================

model AmazonAccount {
  id           String   @id @default(uuid())
  userId       String
  marketplace  String   // e.g. "US", "DE", "JP"
  sellerId     String
  accessKey    String   // Encrypted
  secretKey    String   // Encrypted
  refreshToken String   // Encrypted
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders       AmazonOrder[]
  ppcMetrics   PPCMetric[]
  inventory    AmazonInventory[]
  listingChanges ListingChange[]
  refunds      AmazonRefund[]
  syncLogs     SyncLog[]
  orderImports OrderImportStaging[]
  ppcImports   PPCImportStaging[]
  inventoryImports InventoryImportStaging[]
  listingImports ListingImportStaging[]
  refundImports RefundImportStaging[]

  @@unique([userId, marketplace]) // Ensure unique linkage per user/marketplace combination
  @@index([userId])
  @@index([marketplace])
  @@map("amazon_accounts")
}

model AmazonOrder {
  id            String   @id @default(uuid())
  orderId       String   @unique
  marketplaceId String
  accountId     String   // Links to AmazonAccount.id or internal Account.id? Requirement says "Relationships: User -> AmazonAccount"
  // Requirement: "AmazonOrder model: orderId, marketplaceId, accountId, status, totalAmount, fees (json)"
  // I will link to AmazonAccount for credentials linkage + internal Account for business logic if needed. 
  // Requirement says "Relationships: User -> AmazonAccount -> Marketplace -> Orders" implying AmazonOrder links to AmazonAccount.
  amazonAccountId String
  
  status        String
  totalAmount   Decimal  @default(0)
  fees          Json?    // Stores broken down fees
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([amazonAccountId])
  @@index([orderId])
  @@map("amazon_orders")
}

model PPCMetric {
  id            String   @id @default(uuid())
  campaignId    String
  adGroupId     String?
  keywordId     String?
  
  clicks        Int      @default(0)
  spend         Decimal  @default(0)
  sales         Decimal  @default(0)
  acos          Decimal? 
  
  amazonAccountId String // Linked to AmazonAccount
  marketplaceId   String
  date          DateTime
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([amazonAccountId])
  @@index([campaignId])
  @@index([adGroupId])
  @@index([keywordId])
  @@index([date])
  @@index([amazonAccountId, date])
  @@map("ppc_metrics")
}

model AmazonInventory {
  id            String   @id @default(uuid())
  sku           String
  marketplaceId String
  amazonAccountId String
  
  stockLevel    Int      @default(0)
  inboundQty    Int      @default(0)
  
  updatedAt     DateTime @updatedAt

  // Relations
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@unique([amazonAccountId, sku, marketplaceId])
  @@map("amazon_inventory")
}

model ListingChange {
  id            String   @id @default(uuid())
  sku           String
  marketplaceId String
  amazonAccountId String
  
  changes       Json     // Details of what changed (price, buybox, title)
  detectedAt    DateTime @default(now())

  // Relations
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([amazonAccountId])
  @@index([sku])
  @@map("listing_changes")
}

model AmazonRefund {
  id            String   @id @default(uuid())
  orderId       String   // Amazon order ID
  refundId      String   @unique
  amount        Decimal  @default(0)
  reasonCode    String?
  accountId     String   // Links to AmazonAccount
  marketplaceId String
  processedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  amazonAccount AmazonAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([orderId])
  @@index([marketplaceId])
  @@map("amazon_refunds")
}

// ============================================
// MANUAL DATA IMPORT STAGING TABLES
// ============================================

model OrderImportStaging {
  id            String   @id @default(uuid())
  userId        String
  amazonAccountId String
  marketplaceId String
  rawData       Json     // Parsed CSV/Excel row data
  validated     Boolean  @default(false)
  errorMessages Json?    // Array of validation errors
  status        String   @default("pending") // pending, approved, rejected, finalized
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("order_import_staging")
}

model PPCImportStaging {
  id            String   @id @default(uuid())
  userId        String
  amazonAccountId String
  marketplaceId String
  rawData       Json
  validated     Boolean  @default(false)
  errorMessages Json?
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("ppc_import_staging")
}

model InventoryImportStaging {
  id            String   @id @default(uuid())
  userId        String
  amazonAccountId String
  marketplaceId String
  rawData       Json
  validated     Boolean  @default(false)
  errorMessages Json?
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("inventory_import_staging")
}

model ListingImportStaging {
  id            String   @id @default(uuid())
  userId        String
  amazonAccountId String
  marketplaceId String
  rawData       Json
  validated     Boolean  @default(false)
  errorMessages Json?
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("listing_import_staging")
}

model RefundImportStaging {
  id            String   @id @default(uuid())
  userId        String
  amazonAccountId String
  marketplaceId String
  rawData       Json
  validated     Boolean  @default(false)
  errorMessages Json?
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amazonAccount AmazonAccount @relation(fields: [amazonAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([amazonAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("refund_import_staging")
}
